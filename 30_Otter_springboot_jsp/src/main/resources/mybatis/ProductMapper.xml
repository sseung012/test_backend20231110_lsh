<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.hk.otter.mapper.ProductMapper">
	
	<insert id="insertProduct" parameterType="ProductDto"
	 useGeneratedKeys="true" keyProperty="seq">
		INSERT INTO product
		VALUES(NULL, #{user_seq}, #{img}, #{maker}, #{goal_price}, #{title}, 
				SYSDATE(), NULL, #{close_date}, #{content}, NULL, NULL, #{cate_seq}, 'Y')		
	</insert>
	
<!-- 	제품 상세조회 -->
	<select id="productDetail" parameterType="int" resultType="ProductDto">
		SELECT seq, cate_seq, img, title, maker, goal_price, total_price, close_date, content
		FROM product
		WHERE seq=#{seq}	
	</select>
	

<!-- 	관리자-프로젝트 전체조회(승인) -->
	<select id="getProductList"  resultType="ProductDto">
		SELECT seq, cate_seq, title, maker, created_date, open_date, product_check
		FROM product	
	</select>
	
<!-- 	index페이지에서 작게 프로젝트 조회 -->
	<select id="getProductMini"  resultType="ProductDto">
		SELECT img, title, maker, TIMESTAMPDIFF(DAY, SYSDATE(), close_date+1) AS 남은날짜, total_supporters
		FROM product
		ORDER BY seq DESC
		LIMIT 8;
	</select>

	<resultMap type="ProductDto" id="ProductDtoMap">
      <id property="seq" column="SEQ"/>
      <result property="img" column="IMG" />
      <result property="maker" column="MAKER" />
      <result property="goal_price" column="GOAL_PRICE" />
      <result property="title" column="TITLE" />
      <result property="created_date" column="CREATED_DATE" />
      <result property="close_date" column="CLOSE_DATE" />
      <result property="content" column="CONTENT" />
      <result property="cate_seq" column="CATE_SEQ" />
<!--       <association property="fileBoardDto"></association> -->
      <collection property="RewardDto" resultMap="RewardDtoMap" ></collection>
   </resultMap>
   
   <resultMap type="RewardDto" id="RewardDtoMap">
      <id property="seq"            column="SEQ"/>
      <result property="reward_name"       column="REWARD_NAME"/>
      <result property="price" column="PRICE"/>
      <result property="combination" column="COMBINATION"/>
      <result property="stock" column="STOCK"/>
   </resultMap>

</mapper>
















